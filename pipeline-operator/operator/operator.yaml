apiVersion: kudo.dev/v1beta1
name: "pipeline"
operatorVersion: "0.0.1"
kudoVersion: 0.15.0
kubernetesVersion: 1.16.0
appVersion: 0.0.1
maintainers:
  - name: Zain Malik
    email: zmalik@d2iq.com
tasks:
  - name: kafka
    kind: KudoOperator
    spec:
      package: kafka
      operatorVersion: 1.3.2
      parameterFile: kafka-params.yaml
      instanceName: kafka
  - name: zookeeper
    kind: KudoOperator
    spec:
      package: zookeeper
      operatorVersion: 0.3.1
      parameterFile: zookeeper-params.yaml
      instanceName: zk
  - name: pvc
    kind: Apply
    spec:
      resources:
        - pvc.yaml
  - name: config
    kind: Apply
    spec:
      resources:
        - cassandra.yaml
        - mysql.yaml
  - name: deploy
    kind: Apply
    spec:
      resources:
        - deployment.yaml
plans:
  deploy:
    strategy: serial
    phases:
      - name: dependencies
        strategy: serial
        steps:
          - name: deploy
            tasks:
              - zookeeper
              - kafka
      - name: config-pvc
        strategy: serial
        steps:
          - name: pvc
            task:
              - pvc
          - name: config
            task:
              - config
      - name: app
        strategy: serial
        steps:
          - name: deploy
            task:
              - deployment
